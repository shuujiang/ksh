function laodHuaBu(e){var t=e.type,r=e.serviceId,a=e.refreshTime,i=e.name;thumbnail=e.thumbnail,$(".type").val(t),$("#serviceId").val(r),null!=e.designOption?(HBSX=parseMore(e.designOption),HBSX.refreshTime=a,HBSX.name=i):HBSX=copyAndClear(HBshuxing),multiple=HBSX.multiple,scale=(100+HBSX.addScreen)/100,thisVal1=HBSX.addScreen,header(),""!=thumbnail&&null!=thumbnail&&void 0!=thumbnail?HBSX.activeNames="1":HBSX.activeNames="",$(".basisSet").perfectScrollbar(),$(".directory").perfectScrollbar(),$("#huabuName").val(HBSX.name),$("#HBgrid").css("background-color",HBSX.backgroundColor),HBSX.checked&&($(".beijing").removeClass("hidden"),bgImage(HBSX.backgroundImage)),HBarr.initialValue(HBSX,themeList),0==HBSX.show?HBSX.show=!1:1==HBSX.show&&(HBSX.show=!0),thumbnail=projectName+thumbnail,$(".cover").css("background","url("+thumbnail+") 0 0/100% 100%"),$(".cover").css("background-color","#E5E9F2"),hrefList=getDataFromAjax(ctx+"/qd/test/findAll"),$("#loading").hide(),$.ajax({type:"get",url:ctx+"/qd/test/getAll?id="+getQueryString("id",window.location.href),async:!0,dataType:"json",success:function(e){console.log("-----------请求数据----------"),console.log("-----------筛选器----------"),console.log(e.body.filters),void 0!=e.body.filters&&e.body.filters.forEach(function(e){e.filterOption=parseMore(e.filterOption)}),SXarr=e.body.filters,null!=SXarr?SXarr.forEach(function(e,t){e.absValue=e.absValue||"",e.beginDate=e.beginDate||"",e.endDate=e.endDate||"",e.tempValue1=e.tempValue1||"",e.tempValue2=e.tempValue2||""}):SXarr=[],console.log("-----------筛选器结束----------"),console.log("-----------加载图表----------"),null!=e.body.qdDesignChildrens&&loadChart(e.body.qdDesignChildrens),console.log("-----------加载图表结束----------"),popupPage()}})}function header(){function e(){$(".details-zhong").height(innerHeight-139+"px"),$(".basisSet").height(innerHeight-99+"px"),$(".directory").height(innerHeight-99+"px"),$(".details-zhong").width(innerWidth-480+"px"),$(".chartData").height(innerHeight-59+"px"),$(".chartData_graph").height(innerHeight-139+"px"),screenInitialization(HBSX)}e(),$(window).bind("resize",function(){e(),echartResize(canvasArray)})}function ZSYfull(){function e(){$(".details-zhong").width(innerWidth-80+"px"),$(".details-zhong").height(innerHeight-140+"px"),$(".chartData").height(innerWidth-60+"px"),$(".chartData_graph").height(innerHeight-140+"px"),screenInitialization(HBSX)}e(),$(window).bind("resize",function(){e()})}function adaptive(){function e(){$(".details1").height(innerHeight+"px");var e=HBSX.screen;switch($(".ylconent1").css({width:"100%",height:"100%"}),e){case"ratio1":var t=$(".ylconent1").width()*multiple,r=Math.floor(9/16*t*scale);$(".ylconent2").css({width:t,height:r});break;case"ratio2":$(".ylconent2").css({width:HBSX.screenSize.width+"px",height:HBSX.screenSize.height*scale+"px"});break;case"ratio3":var r=$(".ylconent1").height()*multiple,a=9/16*$(".ylconent1").height(),i=a*multiple;$(".ylconent1").css({width:Math.floor(a)}),$(".ylconent2").css({width:Math.floor(i),height:r*scale})}echartResize(YucanvasArray)}e(),$(window).bind("resize",function(){e()})}function bgImage(e){e=srcSwitch(e),HBSX.backgroundImage=e,$("#HBgrid").css("background","url("+e+") no-repeat"),$("#HBgrid").css("background-color",HBSX.backgroundColor),$("#HBgrid").css("background-size","100% 100%"),$(".tupian").css("background","url("+e+") no-repeat"),$(".tupian").css("background-size","100% 100%")}function tabsSelected(e){$("#"+e).show(),$("#"+e).parent().children(".TabsNameText").css("border-bottom-color","#409EFF").addClass("TabsNameClick1").removeClass("TabsNameClick")}function tabsFun(e,t){$(document).on("click","."+e+" ."+t,function(){$(this).parent().siblings().each(function(e,t){$(t).children(".TabsBox").hide(),$(t).children(".TabsNameText").css("border-bottom-color","rgba(0,0,0,0)").addClass("TabsNameClick").removeClass("TabsNameClick1")});var t=$(this).parent().children(".TabsBox").show().attr("id");$(this).parent().children(".TabsNameText").css("border-bottom-color","#409EFF").addClass("TabsNameClick1").removeClass("TabsNameClick"),chartArrVue(t),canvasArray.forEach(function(r,a){r.id==sxID&&(allOptions[a].staticOption.chartOption[e]=t,"Tabsfrist"==e?VueChartattr.initialValue(allOptions[a],t):"TabsAxis"==e?VueChartattr.initialValue(allOptions[a],"rectangular"):"Tabssecond"==e&&VueChartattr.initialValue(allOptions[a],"legendVisualMap"))})})}function chartArrVue(e){switch(e){case"general":generalIN&&(ChartAttr("general1"),generalIN=!1);break;case"Tgrid":TgridIN&&(ChartAttr("TTGrid"),TgridIN=!1);break;case"series":seriesIN&&(ChartAttr("seriesMarkPoint"),ChartAttr("seriesMarkLine"),ChartAttr("seriesMarkArea"),ChartAttr("seriesGauge"),ChartAttr("seriesLabel"),ChartAttr("seriesLabelLine"),ChartAttr("seriesItemStyle"),ChartAttr("seriesItemStyleMap"),ChartAttr("seriesItemStyleWordCloud"),ChartAttr("seriesLineStyle"),ChartAttr("seriesLineStyleTree"),ChartAttr("seriesAreaStyle"),ChartAttr("seriesLeaves"),ChartAttr("seriesEdgeLabel"),ChartAttr("seriesCategories"),ChartAttr("seriesCategoriesStyle"),ChartAttr("seriesCategoriesLabel"),ChartAttr("seriesCategoriesItemStyle"),ChartAttr("seriesData"),ChartAttr("seriesDataLabel"),ChartAttr("seriesDataLabelLine"),ChartAttr("seriesDataItemStyle"),ChartAttr("seriesDataItemStyleMap"),ChartAttr("seriesDataItemStyleWordCloud"),ChartAttr("seriesDataLineStyle"),ChartAttr("seriesDataStyle"),ChartAttr("seriesLinks"),ChartAttr("seriesLinksStyle"),ChartAttr("seriesLinksLabel"),ChartAttr("seriesLinksLineStyle"),ChartAttr("seriesCommon"),ChartAttr("seriesCommonLine"),ChartAttr("seriesCommonBar"),ChartAttr("seriesCommonPie"),ChartAttr("seriesCommonScatter"),ChartAttr("seriesCommonEffectScatter"),ChartAttr("seriesCommonLines"),ChartAttr("seriesCommonTree"),ChartAttr("seriesCommonMap"),ChartAttr("seriesCommonFunnel"),ChartAttr("seriesCommonGauge"),ChartAttr("seriesCommonGraph"),ChartAttr("seriesCommonWordCloud"),ChartAttr("seriesCommonSymbol"),ChartAttr("seriesCommonSilent"),ChartAttr("seriesCommonlegendHoverLink"),ChartAttr("seriesCommonhoverAnimation"),ChartAttr("seriesCommonAxisIndex"),seriesIN=!1);break;case"textSeries":textSeriesIN&&(ChartAttr("seriesText"),textSeriesIN=!1);break;case"tableSeries":tableSeriesIN&&(ChartAttr("seriesTable"),tableSeriesIN=!1);break;case"title":titleIN&&(ChartAttr("seriestitle"),titleIN=!1);break;case"radar":radarIN&&(ChartAttr("radar1"),ChartAttr("radar2"),radarIN=!1);break;case"rectangular":rectangularIN&&(ChartAttr("xAxis1"),ChartAttr("xAxis2"),ChartAttr("yAxis1"),ChartAttr("yAxis2"),ChartAttr("Grid"),rectangularIN=!1);break;case"geo":geoIN&&(ChartAttr("seriesGeo"),geoIN=!1);break;case"legendVisualMap":legendVisualMapIN&&(ChartAttr("legend"),ChartAttr("visualMap1"),ChartAttr("visualMap2"),legendVisualMapIN=!1);break;case"tooltip":tooltipIN&&(ChartAttr("tooltip1"),ChartAttr("tooltip2"),tooltipIN=!1)}}function pageswitch(){$(".Xvariate").unbind("mousedown"),$(".X_variable").unbind("mouseup"),$(".dimension_x").unbind("mouseup"),$(".Yvariate").unbind("mousedown"),$(".Y_variable").unbind("mouseup"),$(".dimension_y").unbind("mouseup"),$(".ksh1").toggleClass("hidden"),$(".ksh2").toggleClass("hidden"),$("._graph").children().remove(),$(".x-variable").children().remove(),$(".y-variable").children().remove(),$(".X_variable").children().remove(),$(".Y_variable").children().remove()}var appx=angular.module("hlksh",[]),videoHref,thisData,hrefList=[];appx.controller("kshEdit",function(e,t){function r(e,t,r,a){submitData(ctx+"/qd/test/saveAll",{qdDesign:stringifyMore(e),qdFilter:stringifyMore(t),chart:stringifyMore(r),moId:a},function(e){e&&e.success?(top.layer.alert("保存成功"),WGopacity(HBSX.show)):top.layer.alert("保存失败")})}function a(e){e.forEach(function(t,r){"echarts"==e[r].type||"echarts2"==e[r].type||"countUp"==e[r].type?delete e[r].dataOption:(delete e[r].dbsrcId,delete e[r].tableId,delete e[r].sourceType,delete e[r].dims,delete e[r].measures,delete e[r].chartType,delete e[r].chartName),delete e[r].createDate,delete e[r].updateDate,delete e[r].remarks,delete e[r].qdFilter,delete e[r].qdFilterChilrden,e[r].staticOption=stringifyMore(e[r].staticOption),e[r].designId=getQueryString("id",window.location.href)})}$(document).ready(function(){$.ajax({type:"get",url:ctx+"/qd/qdDesignTheme/queryThemes",async:!0,success:function(e){themeList=e,$.ajax({type:"get",url:ctx+"/qd/test/loadDesign?id="+getQueryString("id",window.location.href),async:!0,success:function(e){laodHuaBu(e)}})}})}),e.chartOptionList=chartOptionList,e.componentsList=componentsList,e.clickChart=function(e){clickEcharts(e)},createGraphics(graphics),e.clickComponents=function(e){var t=e.type;componentsFun(t)},e.previewFun=function(){$(window).unbind("resize"),$(".yulan").removeClass("hidden"),$(".ksh1").addClass("hidden"),adaptive(),$(".ylconent2").css({background:"url("+HBSX.backgroundImage+") no-repeat 0 0/ 100% 100%","background-color":HBSX.backgroundColor});var e=$(".ylconent2");$(".ylconent1").perfectScrollbar(),scroll($(".ylconent1")),canvasArray.forEach(function(t,r){if(""!=allOptions[r]){if(boxId=allOptions[r].staticOption.boxId,"content"==boxId)var a=$('<div class="yl"></div>').appendTo(e);else var a=$('<div class="yl"></div>').appendTo($("#"+boxId));a.css("z-index",allOptions[r].staticOption.zIndex);var i=$('<a class="yl1" style="width:100%;height:100%;" id="'+t.id+'"></a>').appendTo(a),s=t.id,n=allOptions[r].staticOption.position.top,o=allOptions[r].staticOption.position.left,l=allOptions[r].staticOption.boxSize.width,c=allOptions[r].staticOption.boxSize.height;allOptions[r].staticOption.boxSize.moHeight;a.width(l+"%"),a.height(c/scale+"%"),a[0].style.top=n/scale+"%",a[0].style.left=o+"%";var d=(t.id,allOptions[r].type);atype="echarts2"==d||"echarts"==d?"echart":d,YucanvasArray.push({id:s,index:r}),init(s,i,d,allOptions[r],YucanvasArray[r])}})},e.closePreviewFun=function(){$(window).unbind("resize"),$(".ylconent2").children().remove(),$(".yulan").addClass("hidden"),$(".ksh1").removeClass("hidden"),YucanvasArray.forEach(function(e){void 0==e.chart&&null==e.chart||(e.chart.dispose(),e.chart=null),void 0!=e.time&&clearInterval(e.time)}),YucanvasArray=[],header(),screenInitialization(HBSX)},e.fullScreenFun=function(){$(".btnscreen").toggleClass("hidden"),$(".details-you").toggleClass("hidden"),$(window).unbind("resize"),ZSYfull(),screenInitialization(HBSX)},e.exitFullScreenFun=function(){$(".btnscreen").toggleClass("hidden"),$(".details-you").toggleClass("hidden"),$(window).unbind("resize"),header(),screenInitialization(HBSX)},e.huabuAttrFun=function(){$(".setUp1").removeClass("setUp-black").addClass("setUp-white"),$(".element1").removeClass("setUp-white").addClass("setUp-black"),$(".directory").addClass("hidden"),$(".huabuAttr").removeClass("hidden")},e.elementFun=function(){$(".setUp1").removeClass("setUp-white").addClass("setUp-black"),$(".element1").removeClass("setUp-black").addClass("setUp-white"),$(".huabuAttr").addClass("hidden"),$(".directory").removeClass("hidden")},e.holdEditorFun=function(){pageswitch();var e=dims.join(","),t=measures.join(",");olDoption.dims=e,olDoption.measures=t,olDoption.dbsrcId=$(".yuan").val(),olDoption.sourceType=$(".yuan option:selected").attr("type"),olDoption.tableId=$(".biao").val(),$("#"+sxID).remove(),"{}"==stringifyMore(olDoption.dataOption)&&(olDoption.dataOption=olDoption.staticOption.dataOption),canvasArray.forEach(function(e,t){if(e.id==sxID){var r=allOptions[t].type,a=$('<div class="element" id="'+sxID+'"></div>').appendTo($(oBox[t]));"echarts"==r||"echarts2"==r?TBSC(olDoption,sxID,a,e):countUpFun(olDoption,sxID,a,e),allOptions[t]=olDoption}}),pitchUp(sxID),olDoption=null,refresh(HBSX.refreshTime)},e.cancelEditorFun=function(){pageswitch(),olDoption=null,refresh(HBSX.refreshTime)},e.holdFun=function(){if(""==HBSX.name||null==HBSX.name||""==HBSX.name.replace(/\s/g,""))return top.layer.alert("画布名称不能为空！"),!1;var e=[],t=0;allOptions.forEach(function(r,a){""!=r&&(r.orderBy=t,e.push(r),t++)});var i=copyAndClear(e);a(i);var s=HBSX,n={id:getQueryString("id",window.location.href),designOption:stringifyMore(s),name:HBSX.name,refreshTime:HBSX.refreshTime+"",thumbnail:dataUrl,type:$(".type").val(),qdService:$("#serviceId").val(),themeId:HBSX.subject},o=copyAndClear(SXarr);o.forEach(function(e,t){e.qdFilterChilrdenList=stringifyMore(e.qdFilterChilrdenList),e.designId=getQueryString("id",window.location.href),e.filterOption=stringifyMore(e.filterOption),delete e.createDate,delete e.updateDate,delete e.remarks}),r(n,o,i,getQueryString("moId",window.location.href))}});var generalIN=!0,TgridIN=!0,seriesIN=!0,textSeriesIN=!0,tableSeriesIN=!0,titleIN=!0,radarIN=!0,rectangularIN=!0,geoIN=!0,legendVisualMapIN=!0,tooltipIN=!0;tabsFun("Tabsfrist","frist"),tabsFun("Tabssecond","legend"),tabsFun("TabsAxis","rectangular");var selContent,SXname,chartList=[],datePickerType;